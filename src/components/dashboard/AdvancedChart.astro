---
const { title = "Advanced Analytics", type = "line", data = [], options = {} } = Astro.props;

// Mock complex chart data
const chartData = data.length ? data : {
  labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
  datasets: [
    {
      label: 'Revenue',
      data: [6500, 5900, 8000, 8100, 5600, 5500, 4000, 5200, 6900, 7200, 8500, 9200],
      borderColor: '#3b82f6',
      backgroundColor: 'rgba(59, 130, 246, 0.1)',
      tension: 0.4,
      fill: true
    },
    {
      label: 'Expenses',
      data: [2800, 3100, 2900, 3400, 3000, 3200, 2800, 2900, 3100, 3300, 3500, 3800],
      borderColor: '#8b5cf6',
      backgroundColor: 'rgba(139, 92, 246, 0.1)',
      tension: 0.4,
      fill: true
    },
    {
      label: 'Profit',
      data: [3700, 2800, 5100, 4700, 2600, 2300, 1200, 2300, 3800, 3900, 5000, 5400],
      borderColor: '#10b981',
      backgroundColor: 'rgba(16, 185, 129, 0.1)',
      tension: 0.4,
      fill: true
    }
  ]
};
---

<div class="bg-white dark:bg-gray-900 rounded-xl shadow-lg border border-gray-200 dark:border-gray-800 p-6">
  <div class="flex flex-col lg:flex-row lg:items-center justify-between mb-6 space-y-4 lg:space-y-0">
    <div>
      <h3 class="text-xl font-bold text-gray-800 dark:text-white">{title}</h3>
      <p class="text-sm text-gray-500 dark:text-gray-400 mt-1">Real-time data with predictive analysis</p>
    </div>
    
    <div class="flex flex-wrap items-center gap-3">
      <div class="flex items-center space-x-2">
        <span class="w-3 h-3 bg-blue-500 rounded-full"></span>
        <span class="text-sm text-gray-600 dark:text-gray-400">Revenue</span>
      </div>
      <div class="flex items-center space-x-2">
        <span class="w-3 h-3 bg-purple-500 rounded-full"></span>
        <span class="text-sm text-gray-600 dark:text-gray-400">Expenses</span>
      </div>
      <div class="flex items-center space-x-2">
        <span class="w-3 h-3 bg-green-500 rounded-full"></span>
        <span class="text-sm text-gray-600 dark:text-gray-400">Profit</span>
      </div>
      
      <div class="relative">
        <select class="appearance-none bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg px-4 py-2 pr-8 text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent">
          <option>Last 7 days</option>
          <option selected>Last 30 days</option>
          <option>Last 90 days</option>
          <option>Last year</option>
          <option>Custom Range</option>
        </select>
        <i class="fas fa-chevron-down absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500 pointer-events-none"></i>
      </div>
      
      <div class="flex items-center space-x-2">
        <button class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800" title="Download">
          <i class="fas fa-download text-gray-600 dark:text-gray-400"></i>
        </button>
        <button class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800" title="Full Screen">
          <i class="fas fa-expand text-gray-600 dark:text-gray-400"></i>
        </button>
        <button class="p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800" title="Settings">
          <i class="fas fa-cog text-gray-600 dark:text-gray-400"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Interactive Chart Container -->
  <div class="relative">
    <div class="h-80">
      <!-- Chart Visualization with multiple series -->
      <div class="absolute inset-0 flex items-end space-x-1 p-4">
        {chartData.labels.map((month, index) => {
          const revenue = chartData.datasets[0].data[index];
          const expenses = chartData.datasets[1].data[index];
          const profit = chartData.datasets[2].data[index];
          const maxValue = Math.max(...chartData.datasets[0].data);
          
          return (
            <div class="flex-1 flex flex-col items-center group" style={{ height: '100%' }}>
              <div class="relative w-full flex items-end justify-center" style={{ height: 'calc(100% - 30px)' }}>
                <!-- Profit bar -->
                <div 
                  class="absolute bottom-0 w-3/4 bg-gradient-to-t from-green-500 to-green-400 rounded-t-lg group-hover:w-full transition-all duration-300 cursor-pointer"
                  style={{ height: `${(profit / maxValue) * 80}%` }}
                  data-tooltip={`Profit: $${profit}`}
                ></div>
                
                <!-- Expenses bar -->
                <div 
                  class="absolute bottom-0 w-3/4 bg-gradient-to-t from-purple-500 to-purple-400 rounded-t-lg group-hover:w-full transition-all duration-300 cursor-pointer"
                  style={{ 
                    height: `${(expenses / maxValue) * 80}%`,
                    transform: 'translateY(-20px)'
                  }}
                  data-tooltip={`Expenses: $${expenses}`}
                ></div>
                
                <!-- Revenue bar -->
                <div 
                  class="absolute bottom-0 w-3/4 bg-gradient-to-t from-blue-500 to-blue-400 rounded-t-lg group-hover:w-full transition-all duration-300 cursor-pointer"
                  style={{ 
                    height: `${(revenue / maxValue) * 80}%`,
                    transform: 'translateY(-40px)'
                  }}
                  data-tooltip={`Revenue: $${revenue}`}
                ></div>
                
                <!-- Tooltip -->
                <div class="absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-3 py-2 bg-gray-900 dark:bg-gray-800 text-white text-sm rounded-lg shadow-xl opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 whitespace-nowrap z-10">
                  <div class="font-medium">{month}</div>
                  <div class="flex items-center space-x-2 mt-1">
                    <div class="w-2 h-2 bg-blue-500 rounded-full"></div>
                    <span>Revenue: ${revenue}</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-purple-500 rounded-full"></div>
                    <span>Expenses: ${expenses}</span>
                  </div>
                  <div class="flex items-center space-x-2">
                    <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                    <span>Profit: ${profit}</span>
                  </div>
                </div>
              </div>
              
              <!-- Month label -->
              <div class="h-8 flex items-center justify-center">
                <span class="text-xs text-gray-500 dark:text-gray-400 font-medium">{month}</span>
              </div>
            </div>
          );
        })}
      </div>
      
      <!-- Y-axis labels -->
      <div class="absolute left-0 top-0 bottom-0 w-12 flex flex-col justify-between py-4">
        {[0, 2500, 5000, 7500, 10000].map((value) => (
          <div class="text-xs text-gray-500 dark:text-gray-400 text-right pr-2">
            ${value.toLocaleString()}
          </div>
        ))}
      </div>
    </div>
    
    <!-- Trend line overlay -->
    <div class="absolute top-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-md p-3">
      <div class="text-sm font-medium text-gray-600 dark:text-gray-400">Trend</div>
      <div class="flex items-center mt-1">
        <i class="fas fa-arrow-up text-green-500 mr-2"></i>
        <span class="text-xl font-bold text-gray-800 dark:text-white">+24.5%</span>
      </div>
      <div class="text-xs text-gray-500 dark:text-gray-400 mt-1">vs last period</div>
    </div>
  </div>

  <!-- Statistics Summary -->
  <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-8 pt-6 border-t border-gray-200 dark:border-gray-800">
    <div class="text-center">
      <div class="text-2xl font-bold text-gray-800 dark:text-white">$92,400</div>
      <div class="text-sm text-gray-500 dark:text-gray-400">Total Revenue</div>
      <div class="flex items-center justify-center text-green-500 text-sm mt-1">
        <i class="fas fa-arrow-up mr-1"></i>
        <span>+12.5%</span>
      </div>
    </div>
    
    <div class="text-center">
      <div class="text-2xl font-bold text-gray-800 dark:text-white">$38,200</div>
      <div class="text-sm text-gray-500 dark:text-gray-400">Total Expenses</div>
      <div class="flex items-center justify-center text-red-500 text-sm mt-1">
        <i class="fas fa-arrow-up mr-1"></i>
        <span>+8.2%</span>
      </div>
    </div>
    
    <div class="text-center">
      <div class="text-2xl font-bold text-gray-800 dark:text-white">$54,200</div>
      <div class="text-sm text-gray-500 dark:text-gray-400">Net Profit</div>
      <div class="flex items-center justify-center text-green-500 text-sm mt-1">
        <i class="fas fa-arrow-up mr-1"></i>
        <span>+18.7%</span>
      </div>
    </div>
  </div>

  <!-- Prediction Section -->
  <div class="mt-6 p-4 bg-gradient-to-r from-blue-50 to-indigo-50 dark:from-gray-800 dark:to-gray-800 rounded-xl">
    <div class="flex items-center justify-between">
      <div>
        <h4 class="font-semibold text-gray-800 dark:text-white">Next Month Prediction</h4>
        <p class="text-sm text-gray-600 dark:text-gray-400">Based on current trends</p>
      </div>
      <div class="text-right">
        <div class="text-2xl font-bold text-gray-800 dark:text-white">$98,500</div>
        <div class="text-sm text-green-500">Expected Revenue</div>
      </div>
    </div>
    <div class="mt-4 w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
      <div 
        class="bg-gradient-to-r from-blue-500 to-purple-500 h-2 rounded-full" 
        style="width: 85%"
      ></div>
    </div>
    <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-2">
      <span>Low</span>
      <span>High</span>
    </div>
  </div>
</div>

<style>
  .chart-tooltip {
    pointer-events: none;
  }
  
  .bar-hover {
    transition: all 0.3s ease;
  }
  
  .bar-hover:hover {
    transform: scaleX(1.1);
    opacity: 0.9;
  }
</style>

<script>
  // Chart interactions
  document.addEventListener('DOMContentLoaded', function() {
    const bars = document.querySelectorAll('[data-tooltip]');
    
    bars.forEach(bar => {
      bar.addEventListener('mouseenter', function(e) {
        const tooltip = this.parentElement.querySelector('.absolute.bottom-full');
        if (tooltip) {
          tooltip.style.opacity = '1';
          tooltip.style.visibility = 'visible';
        }
      });
      
      bar.addEventListener('mouseleave', function(e) {
        const tooltip = this.parentElement.querySelector('.absolute.bottom-full');
        if (tooltip) {
          tooltip.style.opacity = '0';
          tooltip.style.visibility = 'hidden';
        }
      });
    });
    
    // Auto-update chart data every 30 seconds (simulated)
    setInterval(() => {
      console.log('Updating chart data...');
      // In a real app, this would fetch new data from an API
    }, 30000);
  });
</script>