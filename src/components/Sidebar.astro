---
import { themeStore } from '../../stores/theme.astro.js';

const mainMenu = [
  { 
    title: "Dashboard", 
    icon: "fas fa-home", 
    active: true,
    submenu: [
      { label: "Overview", path: "/" },
      { label: "Analytics", path: "/analytics" },
      { label: "E-commerce", path: "/ecommerce" },
      { label: "CRM", path: "/crm" }
    ]
  },
  { 
    title: "Analytics", 
    icon: "fas fa-chart-line",
    badge: "5",
    submenu: [
      { label: "Revenue", path: "/analytics/revenue" },
      { label: "Traffic", path: "/analytics/traffic" },
      { label: "Conversions", path: "/analytics/conversions" },
      { label: "Retention", path: "/analytics/retention" }
    ]
  },
  { 
    title: "Users", 
    icon: "fas fa-users",
    count: "2.4k",
    submenu: [
      { label: "All Users", path: "/users" },
      { label: "User Groups", path: "/users/groups" },
      { label: "Permissions", path: "/users/permissions" },
      { label: "Activity Log", path: "/users/activity" }
    ]
  },
  { 
    title: "Orders", 
    icon: "fas fa-shopping-cart",
    badge: "12",
    submenu: [
      { label: "All Orders", path: "/orders" },
      { label: "Pending", path: "/orders/pending" },
      { label: "Completed", path: "/orders/completed" },
      { label: "Returns", path: "/orders/returns" }
    ]
  },
  { 
    title: "Products", 
    icon: "fas fa-box",
    submenu: [
      { label: "Inventory", path: "/products" },
      { label: "Categories", path: "/products/categories" },
      { label: "Attributes", path: "/products/attributes" },
      { label: "Reviews", path: "/products/reviews" }
    ]
  },
  { 
    title: "Finance", 
    icon: "fas fa-wallet",
    submenu: [
      { label: "Transactions", path: "/finance" },
      { label: "Invoices", path: "/finance/invoices" },
      { label: "Taxes", path: "/finance/taxes" },
      { label: "Reports", path: "/finance/reports" }
    ]
  }
];

const secondaryMenu = [
  { title: "Settings", icon: "fas fa-cog", path: "/settings" },
  { title: "Help Center", icon: "fas fa-life-ring", path: "/help" },
  { title: "Documentation", icon: "fas fa-book", path: "/docs" }
];
---

<div class="sidebar-container">
  <!-- Mobile Overlay (hidden by default) -->
  <div 
    id="sidebar-overlay"
    class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"
    onclick="closeSidebar()"
  ></div>

  <!-- Sidebar -->
  <aside 
    id="sidebar"
    class="fixed lg:static inset-y-0 left-0 z-50 w-64 bg-white dark:bg-gray-900 border-r border-gray-200 dark:border-gray-800 h-screen transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out"
  >
    <!-- Logo -->
    <div class="p-6 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between">
      <div class="flex items-center space-x-3">
        <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
          <i class="fas fa-chart-network text-white text-xl"></i>
        </div>
        <h2 class="text-xl font-bold text-gray-800 dark:text-white">ProDash</h2>
      </div>
      
      <!-- Mobile close button -->
      <button 
        class="lg:hidden p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800"
        onclick="closeSidebar()"
      >
        <i class="fas fa-times text-gray-600 dark:text-gray-300"></i>
      </button>
    </div>

    <!-- Search -->
    <div class="p-4 border-b border-gray-200 dark:border-gray-800">
      <div class="relative">
        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 dark:text-gray-500"></i>
        <input
          type="text"
          placeholder="Search menu..."
          class="w-full pl-10 pr-4 py-2 bg-gray-50 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
        />
      </div>
    </div>

    <!-- Navigation -->
    <div class="p-4 flex-1 overflow-y-auto">
      <nav class="space-y-1">
        {mainMenu.map((item) => (
          <div class="group">
            <a
              href="#"
              class={`flex items-center justify-between px-4 py-3 rounded-lg transition-all ${
                item.active
                  ? "bg-blue-50 dark:bg-gray-800 text-blue-600 dark:text-blue-400 font-medium"
                  : "text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"
              }`}
            >
              <div class="flex items-center space-x-3">
                <i class={`${item.icon} w-5 text-center`}></i>
                <span>{item.title}</span>
              </div>
              <div class="flex items-center space-x-2">
                {item.badge && (
                  <span class="px-2 py-1 text-xs font-medium bg-red-100 dark:bg-red-900 text-red-600 dark:text-red-300 rounded-full">
                    {item.badge}
                  </span>
                )}
                {item.count && (
                  <span class="text-xs text-gray-500 dark:text-gray-400">{item.count}</span>
                )}
                <i class="fas fa-chevron-down text-xs transition-transform group-hover:rotate-180"></i>
              </div>
            </a>
            
            <!-- Submenu -->
            <div class="ml-4 pl-8 mt-1 space-y-1 border-l border-gray-200 dark:border-gray-700 hidden group-hover:block">
              {item.submenu.map((sub) => (
                <a
                  href={sub.path}
                  class="flex items-center space-x-3 px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800"
                  onclick="closeSidebar()"
                >
                  <i class="fas fa-circle text-xs opacity-50"></i>
                  <span>{sub.label}</span>
                </a>
              ))}
            </div>
          </div>
        ))}
      </nav>
      
      <!-- Divider -->
      <div class="my-6 border-t border-gray-200 dark:border-gray-800"></div>
      
      <!-- Secondary Menu -->
      <nav class="space-y-1">
        {secondaryMenu.map((item) => (
          <a
            href={item.path}
            class="flex items-center space-x-3 px-4 py-3 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 rounded-lg transition-colors"
            onclick="closeSidebar()"
          >
            <i class={`${item.icon} w-5 text-center`}></i>
            <span>{item.title}</span>
          </a>
        ))}
      </nav>
    </div>

    <!-- User Card -->
    <div class="p-4 border-t border-gray-200 dark:border-gray-800">
      <div class="bg-gradient-to-r from-blue-50 to-purple-50 dark:from-gray-800 dark:to-gray-800 rounded-xl p-4">
        <div class="flex items-center space-x-3">
          <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center">
            <i class="fas fa-crown text-white"></i>
          </div>
          <div>
            <p class="font-semibold text-gray-800 dark:text-white">Pro Plan</p>
            <p class="text-sm text-gray-600 dark:text-gray-400">Expires in 24 days</p>
          </div>
        </div>
        <div class="mt-4">
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-600 dark:text-gray-400">Storage</span>
            <span class="font-medium text-gray-800 dark:text-white">8.2/12 GB</span>
          </div>
          <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
            <div 
              class="bg-gradient-to-r from-blue-500 to-purple-600 h-2 rounded-full" 
              style="width: 68%"
            ></div>
          </div>
        </div>
        <button class="w-full mt-4 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 text-gray-800 dark:text-white py-2 rounded-lg text-sm font-medium hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors">
          Upgrade Plan
        </button>
      </div>
    </div>
  </aside>
</div>

<script>
  // Sidebar functions
  function openSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    if (sidebar && overlay) {
      sidebar.classList.remove('-translate-x-full');
      overlay.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
  }
  
  function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    if (sidebar && overlay) {
      sidebar.classList.add('-translate-x-full');
      overlay.classList.add('hidden');
      document.body.style.overflow = '';
    }
  }
  
  function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    if (sidebar) {
      if (sidebar.classList.contains('-translate-x-full')) {
        openSidebar();
      } else {
        closeSidebar();
      }
    }
  }
  
  // Initialize on load
  document.addEventListener('DOMContentLoaded', function() {
    // Close sidebar when clicking outside on mobile
    document.addEventListener('click', function(e) {
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');
      const mobileMenuButton = document.getElementById('mobile-menu-button');
      
      if (window.innerWidth < 1024 && 
          sidebar && 
          !sidebar.classList.contains('-translate-x-full') &&
          e.target === overlay) {
        closeSidebar();
      }
    });
    
    // Close on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && window.innerWidth < 1024) {
        closeSidebar();
      }
    });
    
    // Close sidebar when clicking on nav links (mobile)
    document.querySelectorAll('#sidebar a[href]').forEach(link => {
      link.addEventListener('click', function(e) {
        if (window.innerWidth < 1024 && this.getAttribute('href') !== '#') {
          closeSidebar();
        }
      });
    });
    
    // Handle window resize
    function handleResize() {
      if (window.innerWidth >= 1024) {
        // On desktop, ensure sidebar is visible and remove overlay
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (sidebar) {
          sidebar.classList.remove('-translate-x-full');
        }
        if (overlay) {
          overlay.classList.add('hidden');
        }
        document.body.style.overflow = '';
      } else {
        // On mobile, ensure sidebar is hidden by default
        const sidebar = document.getElementById('sidebar');
        if (sidebar) {
          sidebar.classList.add('-translate-x-full');
        }
      }
    }
    
    window.addEventListener('resize', handleResize);
    handleResize(); // Initial call
  });
  
  // Expose to window for global access
  window.openSidebar = openSidebar;
  window.closeSidebar = closeSidebar;
  window.toggleSidebar = toggleSidebar;
</script>

<style>
  /* Smooth transitions */
  #sidebar {
    transition: transform 0.3s ease-in-out;
  }
  
  #sidebar-overlay {
    transition: opacity 0.3s ease-in-out;
  }
  
  /* Prevent body scroll when sidebar is open */
  body.sidebar-open {
    overflow: hidden;
  }
</style>